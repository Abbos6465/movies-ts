import {getMovies, Movie, MoviesParams, getVideo, getCategories, Category} from "./movies/index.js";import {$, $$, createElement} from "./utils/pulign.js";import {setPagination} from "./components/ui/app-pagination.js";import {toggleModal} from "./components/ui/app-modal.js";const filterForm: MoviesParams = {    name: "",    rate: null,    category: "",    page: 1,}const moviesLoader = <HTMLDivElement> $("#moviesLoader");const homeCards = <HTMLDivElement> $(".home__cards");const moviesData = <HTMLDivElement> $("#moviesData");const homeFooter = <HTMLDivElement> $("#homeFooter");const movieModalOverlay = <HTMLDivElement> $("#movieModalOverlay");const movieModalIframe = <HTMLIFrameElement> $(".home__movie-modal__iframe");const showMovie = (id:string): void => {    const movie: Movie | null = getVideo(id);    if(movie) movieModalIframe.src=movie.video_url;    toggleModal();}movieModalOverlay.addEventListener("click", ():void => {    movieModalIframe.src = "";});let moviesIsLoading: Boolean = true;const paginationName: string = "movies";const videoBoxClick = (): void => {    const homeCardVideoBoxes = $$('.home__card__video-box') as NodeListOf<HTMLButtonElement>;    homeCardVideoBoxes.forEach(el => {        el.addEventListener("click", event => {            const currentTarget = <HTMLButtonElement>event.currentTarget;            if (currentTarget) {                const id: string | null = currentTarget?.getAttribute('data-id');                if (id) showMovie(id);            }        });    });}let movies: Movie[] = [];let activePage: number = 1;let lastPage: number;const fetchMovies = (): void => {    const {data, page, last_page} = getMovies(filterForm);    moviesIsLoading = true;    moviesData.style.display = "none";    moviesLoader.style.display = moviesIsLoading ? "" : "none";    movies = data;    activePage = page;    lastPage = last_page;    homeCards.innerHTML = "";    homeFooter.innerHTML = "";    setTimeout(() => {        moviesData.style.display = "";        moviesIsLoading = false;        moviesLoader.style.display = moviesIsLoading ? "" : "none";    }, 500);};const categories: Category[] = getCategories();const movieCategorySelect = <HTMLSelectElement> $("#categorySelect");categories.forEach(el => {    const optionElement = <HTMLOptionElement> new Option(el.name, el.id);    movieCategorySelect.options.add(optionElement);});const renderMovies = (): void => {    fetchMovies();    movies.forEach(el => {        let homeCard = <HTMLDivElement> createElement('div', 'app-card home__card', `               <div class="app-card__header">                <button                    data-id="${el.id}"                    class="home__card__video-box video-box app-card__img-wrapper"                >                  <img                      class="video-box__img app-card__img"                      src="${el.smallImg}"                      alt="Movie img"                  >                </button>              </div>              <div class="app-card__body">                <h3 class="app-card__title">                  ${el.title}               </h3>                <ul class="home__card__list">                  <li class="home__card__list__item">                    <span class="home__card__list__item-title">                        Year:                    </span>                    <span class="home__card__list__item-text">                        ${el.year}                    </span>                  </li>                  <li class="home__card__list__item">                    <span class="home__card__list__item-title">                        Category:                    </span>                    <span class="home__card__list__item-text">                      ${el?.categories.join(', ') ?? ''}                     </span>                  </li>                  <li class="home__card__list__item">                    <span class="home__card__list__item-title">                        Rating:                    </span>                    <span class="home__card__list__item-text">                      ${el?.rating ?? ''}                     </span>                  </li>                  <li class="home__card__list__item">                    <span class="home__card__list__item-title">                        Time:                    </span>                    <span class="home__card__list__item-text">                      ${el?.time ?? ''}                     </span>                  </li>                </ul>              </div>        `);        // homeCard.dataset.movieId=el.id;        homeCards.appendChild(homeCard);    });    const pagination = <HTMLDivElement>setPagination(paginationName, activePage, lastPage);     homeFooter.appendChild(pagination);    videoBoxClick();    paginationHandler();}const paginationHandler = ():void => {    const pagination = <HTMLDivElement>$(`#${paginationName}-pagination`);    if (pagination) {        const paginationButtons = pagination.querySelectorAll('.app-pagination__btn') as NodeListOf<HTMLButtonElement>;        paginationButtons.forEach(el => {            el.addEventListener("click", event => {                const currentTarget = <HTMLButtonElement>event.currentTarget;                if (currentTarget) {                    const dataId: string | null = currentTarget?.getAttribute('data-id');                    if (dataId) {                        if (dataId === 'prev') activePage--;                        else if (dataId === 'next') activePage++;                        else activePage = +dataId;                        filterForm.page = activePage;                        fetchMovies();                        renderMovies();                    }                }            });        });    }}renderMovies();const movieName = <HTMLInputElement> $("#movieName");const movieRate = <HTMLInputElement> $("#movieRate");const filterMovies = (): void => {    if(movieName.value.trim().length) filterForm.name = movieName.value;    if(movieRate.value) filterForm.rate = +movieRate.value;    if(movieCategorySelect.value) filterForm.category = movieCategorySelect.value;    if(filterForm.name || filterForm.rate || filterForm.category) renderMovies();}const moviesSearchBtn = <HTMLButtonElement> $("#moviesSearchBtn");moviesSearchBtn.addEventListener("click", filterMovies);